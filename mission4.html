<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>English Vocabulary Game V6</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #2c3e50;
        margin: 0;
        padding: 0;
        text-align: center;
        color: white;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        user-select: none; /* é˜²æ­¢é€£é»é¸å–æ–‡å­— */
    }

    /* === é€šç”¨ UI === */
    h1 { margin: 15px 0; font-size: 1.5rem; text-shadow: 2px 2px 0 #000; }
    
    .screen {
        display: none;
        width: 100%;
        height: 100%;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
    }
    
    .screen.active { display: flex; }

    button {
        cursor: pointer;
        font-family: inherit;
        -webkit-tap-highlight-color: transparent;
        outline: none;
        touch-action: manipulation; /* å„ªåŒ–è§¸æ§åæ‡‰ */
    }
    button:active { transform: scale(0.96); }

    /* === 0. å•Ÿå‹•é®ç½© === */
    #start-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.95); z-index: 999;
    }
    .big-start-btn {
        background: #27ae60; color: white; border: none;
        padding: 20px 60px; font-size: 24px; border-radius: 50px;
        box-shadow: 0 6px 0 #219150;
        transition: all 0.1s;
        margin-bottom: 20px;
    }
    .big-start-btn:active {
        background: #2ecc71;
        transform: translateY(4px);
        box-shadow: 0 2px 0 #219150;
    }
    .debug-text {
        font-size: 12px; color: #7f8c8d; margin-top: 10px; font-family: monospace;
    }

    /* === 1. ä¸»é¸å–® (Menu) === */
    .menu-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
        width: 100%;
        max-width: 400px;
        overflow-y: auto;
        padding-bottom: 20px;
    }
    .menu-btn {
        padding: 20px;
        border: none;
        border-radius: 15px;
        font-size: 18px;
        font-weight: bold;
        color: white;
        text-align: left;
        position: relative;
        box-shadow: 0 5px 0 rgba(0,0,0,0.2);
    }
    .menu-btn::after {
        content: 'â–¶'; position: absolute; right: 20px; opacity: 0.5;
    }
    .g1-btn { background: #e74c3c; } 
    .g2-btn { background: #f39c12; } 
    .g3-btn { background: #8e44ad; } 
    .g4-btn { background: #3498db; } 

    /* === 2. éŠæˆ²ç•«é¢ (Game) === */
    .progress-bar {
        width: 100%; max-width: 400px; height: 10px;
        background: #34495e; border-radius: 5px; margin-bottom: 20px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%; background: #f1c40f; width: 0%; transition: width 0.3s;
    }

    .card-display {
        background: white;
        color: #2c3e50;
        width: 100%; max-width: 350px;
        padding: 30px 20px;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 10px 0 rgba(0,0,0,0.2);
        position: relative;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .english-word { font-size: 32px; font-weight: bold; display: block; margin-bottom: 10px; word-break: break-word;}
    .replay-icon { 
        font-size: 24px; color: #3498db; cursor: pointer; 
        background: #ecf0f1; border-radius: 50%; width: 50px; height: 50px;
        display: inline-flex; justify-content: center; align-items: center;
        box-shadow: 0 3px 0 rgba(0,0,0,0.1);
    }
    .replay-icon:active { transform: scale(0.95); background: #dcdde1; }

    .options-grid {
        display: grid; grid-template-columns: 1fr; gap: 12px;
        width: 100%; max-width: 350px;
    }
    .option-btn {
        background: #34495e; color: white;
        border: none; padding: 15px; border-radius: 10px;
        font-size: 20px; box-shadow: 0 4px 0 #2c3e50;
        transition: background 0.2s;
    }
    .option-btn:hover { background: #3e5871; } /* é›»è…¦ç‰ˆæ»‘é¼ æ‡¸åœæ•ˆæœ */
    
    .correct { background: #2ecc71 !important; box-shadow: 0 4px 0 #27ae60 !important; }
    .wrong { background: #e74c3c !important; opacity: 0.6; }

    /* === 3. çµç®—ç•«é¢ (Result) === */
    .score-circle {
        width: 150px; height: 150px;
        background: white; border-radius: 50%;
        color: #2c3e50; display: flex;
        justify-content: center; align-items: center;
        font-size: 60px; font-weight: bold;
        margin-bottom: 20px;
        border: 8px solid #f1c40f;
    }
    .home-btn {
        background: #95a5a6; color: white;
        padding: 15px 40px; border-radius: 30px;
        border: none; font-size: 18px; margin-top: 30px;
    }

</style>
</head>
<body>

    <!-- 0. å•Ÿå‹•å±¤ -->
    <div id="start-overlay" class="screen active">
        <div style="font-size:60px; margin-bottom:20px;">ğŸ®</div>
        <h2 style="margin-bottom:30px;">æº–å‚™å¥½æŒ‘æˆ°äº†å—ï¼Ÿ</h2>
        
        <!-- START æŒ‰éˆ• -->
        <button id="start-btn" class="big-start-btn" onclick="forceStart()">START</button>
        
        <p style="opacity:0.6; margin-top:10px; font-size:14px;">é»æ“Šé–‹å§‹é€²å…¥éŠæˆ²</p>
        <div id="debug-status" class="debug-text">System initializing...</div>
    </div>

    <!-- 1. ä¸»é¸å–® -->
    <div id="menu-screen" class="screen">
        <h1>ğŸ† å–®å­—å¤§æŒ‘æˆ°</h1>
        <p style="margin-bottom: 30px; opacity: 0.8;">è«‹é¸æ“‡è¦æŒ‘æˆ°çš„é—œå¡</p>
        
        <div class="menu-grid">
            <button class="menu-btn g1-btn" onclick="startGame('g1')">
                Week 8 - Group 1<br><small>æ­·å²èˆ‡æ–‡æ˜ (History)</small>
            </button>
            <button class="menu-btn g2-btn" onclick="startGame('g2')">
                Week 8 - Group 2<br><small>ç™¼æ˜èˆ‡ç”Ÿæ´» (Invention)</small>
            </button>
            <button class="menu-btn g3-btn" onclick="startGame('g3')">
                Week 9 - Group 3<br><small>å¾Œé™¢å¯¶è— (Treasure)</small>
            </button>
            <button class="menu-btn g4-btn" onclick="startGame('g4')">
                Week 9 - Group 4<br><small>å¤è€å»ºç¯‰ (Ancient)</small>
            </button>
        </div>
    </div>

    <!-- 2. éŠæˆ²ç•«é¢ -->
    <div id="game-screen" class="screen">
        <button onclick="goHome()" style="background:none; border:none; color:white; align-self:flex-start; margin-bottom:10px; font-size:16px;">â¬… å›é¸å–® (Menu)</button>
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        
        <div class="card-display">
            <span id="q-word" class="english-word">Loading...</span>
            <div class="replay-icon" onclick="replayAudio()">ğŸ”Š</div>
        </div>

        <div id="options-container" class="options-grid">
            <!-- é¸é …æŒ‰éˆ•ç”± JS ç”¢ç”Ÿ -->
        </div>
    </div>

    <!-- 3. çµç®—ç•«é¢ -->
    <div id="result-screen" class="screen">
        <h1>æŒ‘æˆ°å®Œæˆï¼</h1>
        <div class="score-circle" id="final-score">0</div>
        <h2 id="feedback-text">Good Job!</h2>
        <button class="home-btn" onclick="goHome()">ğŸ  å›ä¸»é¸å–®</button>
    </div>

<script>
    // === è³‡æ–™åº« ===
    const gameData = {
        g1: [
            { en: "exhibition", ch: "å±•è¦½" }, { en: "century", ch: "ä¸–ç´€" },
            { en: "capital", ch: "é¦–éƒ½ / è³‡é‡‘" }, { en: "empire", ch: "å¸åœ‹" },
            { en: "pyramid", ch: "é‡‘å­—å¡”" }
        ],
        g2: [
            { en: "jewelry", ch: "ç å¯¶" }, { en: "invent", ch: "ç™¼æ˜" },
            { en: "calendar", ch: "æ—¥æ›†" }, { en: "built", ch: "å»ºé€ (éå»å¼)" },
            { en: "feather", ch: "ç¾½æ¯›" }
        ],
        g3: [
            { en: "backyard", ch: "å¾Œé™¢" }, { en: "pottery", ch: "é™¶å™¨" },
            { en: "metal", ch: "é‡‘å±¬" }, { en: "treasure", ch: "å¯¶è—" },
            { en: "middle", ch: "ä¸­é–“" }
        ],
        g4: [
            { en: "ancient", ch: "å¤ä»£çš„" }, { en: "building", ch: "å»ºç¯‰ç‰©" },
            { en: "maize", ch: "ç‰ç±³" }, { en: "keyhole", ch: "é‘°åŒ™å­”" },
            { en: "summary", ch: "æ‘˜è¦" }
        ]
    };

    // æ”¶é›†æ‰€æœ‰ä¸­æ–‡è§£é‡‹
    let allDefinitions = [];
    Object.values(gameData).forEach(group => {
        group.forEach(item => allDefinitions.push(item.ch));
    });

    // === ç³»çµ±è®Šæ•¸ ===
    let currentGroupData = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswering = false; 
    let synth = window.speechSynthesis;
    let selectedVoice = null;

    // === 1. åˆå§‹åŒ–æª¢æŸ¥ (Debug Info) ===
    function checkAudioStatus() {
        const debugEl = document.getElementById('debug-status');
        if (!synth) {
            debugEl.innerText = "Audio Engine: Not supported (Silent Mode)";
            return;
        }
        const voices = synth.getVoices();
        if (voices.length > 0) {
            debugEl.innerText = `Audio Engine: Ready (${voices.length} voices found)`;
        } else {
            debugEl.innerText = "Audio Engine: Loading voices...";
        }
    }
    
    // é€±æœŸæ€§æª¢æŸ¥è²éŸ³è¼‰å…¥ç‹€æ³
    setInterval(checkAudioStatus, 1000);
    if (synth && synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = checkAudioStatus;
    }

    // === 2. å¼·åˆ¶å•Ÿå‹• (æ ¸å¿ƒä¿®å¾©) ===
    function forceStart() {
        const btn = document.getElementById('start-btn');
        btn.innerText = "Starting..."; 
        
        // A. å˜—è©¦æ’­æ”¾è²éŸ³ (å¦‚æœæœ‰éŒ¯ç›´æ¥å¿½ç•¥ï¼Œä¸é˜»æ“‹)
        try {
            if (synth) {
                synth.cancel();
                const u = new SpeechSynthesisUtterance("Welcome");
                u.volume = 0.5; 
                synth.speak(u);
                
                // å˜—è©¦æŠ“å–æœ€ä½³è²éŸ³
                const voices = synth.getVoices();
                selectedVoice = voices.find(v => v.name === 'Samantha') || 
                                voices.find(v => v.lang === 'en-US' && !v.name.includes('Compact')) ||
                                voices.find(v => v.lang === 'en-US');
            }
        } catch (e) {
            console.warn("Audio init warning:", e);
        }

        // B. ç„¡è«–å¦‚ä½•ï¼Œ300ms å¾Œå¼·åˆ¶åˆ‡æ›ç•«é¢
        setTimeout(() => {
            document.getElementById('start-overlay').classList.remove('active');
            document.getElementById('menu-screen').classList.add('active');
        }, 300);
    }

    // === 3. éŠæˆ²æµç¨‹ ===
    function startGame(groupId) {
        currentGroupData = [...gameData[groupId]]; 
        currentGroupData.sort(() => Math.random() - 0.5); // æ´—ç‰Œ
        
        currentQuestionIndex = 0;
        score = 0;
        
        document.getElementById('menu-screen').classList.remove('active');
        document.getElementById('game-screen').classList.add('active');
        
        loadQuestion();
    }

    function loadQuestion() {
        if (currentQuestionIndex >= currentGroupData.length) {
            endGame();
            return;
        }

        isAnswering = false;
        const currentQ = currentGroupData[currentQuestionIndex];
        
        // æ›´æ–° UI
        document.getElementById('q-word').innerText = currentQ.en;
        document.getElementById('progress-fill').style.width = 
            ((currentQuestionIndex) / currentGroupData.length * 100) + '%';

        // ç”¢ç”Ÿé¸é …
        const options = generateOptions(currentQ.ch);
        const container = document.getElementById('options-container');
        container.innerHTML = ''; 

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            // ç›´æ¥ä½¿ç”¨ onclickï¼Œé¿å… PC/Mobile è¡çª
            btn.onclick = function() { checkAnswer(this, opt, currentQ.ch); };
            container.appendChild(btn);
        });

        // è‡ªå‹•æ’­æ”¾è²éŸ³
        setTimeout(() => speak(currentQ.en), 300);
    }

    function generateOptions(correctAnswer) {
        let opts = [correctAnswer];
        let safety = 0;
        while (opts.length < 3 && safety < 50) {
            const randomDef = allDefinitions[Math.floor(Math.random() * allDefinitions.length)];
            if (!opts.includes(randomDef)) opts.push(randomDef);
            safety++;
        }
        return opts.sort(() => Math.random() - 0.5);
    }

    function checkAnswer(btn, selected, correct) {
        if (isAnswering) return;
        isAnswering = true;

        if (selected === correct) {
            btn.classList.add('correct');
            score += 100; 
            speak("Correct"); 
        } else {
            btn.classList.add('wrong');
            // æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
            const buttons = container = document.getElementById('options-container').children;
            for(let b of buttons) {
                if(b.innerText === correct) b.classList.add('correct');
            }
            speak("Nice try");
        }

        setTimeout(() => {
            currentQuestionIndex++;
            loadQuestion();
        }, 1500);
    }

    function endGame() {
        document.getElementById('game-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        
        const finalScore = score;
        const maxScore = currentGroupData.length * 100;
        document.getElementById('final-score').innerText = finalScore;
        
        const feedback = document.getElementById('feedback-text');
        if (finalScore === maxScore) {
            feedback.innerText = "ğŸŒŸ å¤ªå®Œç¾äº†ï¼å…¨å°ï¼";
            speak("Perfect score!");
        } else if (finalScore >= maxScore * 0.6) {
            feedback.innerText = "ğŸ‘ å¾ˆæ£’å–”ï¼ç¹¼çºŒåŠ æ²¹ï¼";
            speak("Good job!");
        } else {
            feedback.innerText = "ğŸ’ª å†ç·´ç¿’ä¸€æ¬¡æœƒæ›´å¥½ï¼";
            speak("Keep practicing!");
        }
    }

    function goHome() {
        document.getElementById('result-screen').classList.remove('active');
        document.getElementById('game-screen').classList.remove('active');
        document.getElementById('menu-screen').classList.add('active');
    }

    function replayAudio() {
        const word = document.getElementById('q-word').innerText;
        speak(word);
    }

    function speak(text) {
        if (!synth) return;
        try {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(text);
            if (selectedVoice) u.voice = selectedVoice;
            u.lang = 'en-US';
            u.rate = 0.9;
            synth.speak(u);
        } catch(e) {
            console.error("Speak error:", e);
        }
    }

</script>
</body>
</html>